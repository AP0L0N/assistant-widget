(function(e,l){typeof exports=="object"&&typeof module<"u"?l(require("vue")):typeof define=="function"&&define.amd?define(["vue"],l):(e=typeof globalThis<"u"?globalThis:e||self,l(e.Vue))})(this,function(e){"use strict";const l=(s,t)=>{const n=s.__vccOpts||s;for(const[c,r]of t)n[c]=r;return n},m={name:"ChatMessage",props:{message:{type:Object,required:!0},primaryColor:{type:String,default:"#007bff"}},computed:{messageClasses(){return{"message-user":this.message.type==="user","message-ai":this.message.type==="ai","message-loading":this.message.type==="loading"}},formattedContent(){return this.message.content?this.message.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>'):""}},methods:{formatTime(s){return s?new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""},handleProductClick(s){this.$emit("product-click",s)}}},g={class:"message-content"},h=["innerHTML"],p={key:0,class:"product-suggestions"},u={class:"products-grid"},f=["onClick"],y={key:0,class:"product-image"},k=["src","alt"],C={class:"product-info"},_={class:"product-name"},b={key:0,class:"product-brand"},w={key:1,class:"product-description"},S={key:2,class:"product-details"},B={class:"product-category"},E={key:0,class:"product-options"},I={key:0,class:"product-sizes"},N={key:1,class:"product-colors"},V={key:3,class:"product-price"},M={class:"product-actions"},z=["href","onClick"],T={class:"message-time"};function D(s,t,n,c,r,a){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message",a.messageClasses])},[e.createElementVNode("div",g,[e.createElementVNode("div",{class:"message-text",innerHTML:a.formattedContent},null,8,h),n.message.products&&n.message.products.length?(e.openBlock(),e.createElementBlock("div",p,[t[2]||(t[2]=e.createElementVNode("h4",{class:"suggestions-title"},"Recommended Products:",-1)),e.createElementVNode("div",u,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.message.products,o=>(e.openBlock(),e.createElementBlock("div",{key:o.id,class:"product-card",onClick:i=>a.handleProductClick(o)},[o.image?(e.openBlock(),e.createElementBlock("div",y,[e.createElementVNode("img",{src:o.image,alt:o.name},null,8,k)])):e.createCommentVNode("",!0),e.createElementVNode("div",C,[e.createElementVNode("h5",_,e.toDisplayString(o.name),1),o.brand?(e.openBlock(),e.createElementBlock("p",b,e.toDisplayString(o.brand),1)):e.createCommentVNode("",!0),o.description?(e.openBlock(),e.createElementBlock("p",w,e.toDisplayString(o.description),1)):e.createCommentVNode("",!0),o.category?(e.openBlock(),e.createElementBlock("div",S,[e.createElementVNode("span",B,e.toDisplayString(o.category),1),o.sizes||o.colors?(e.openBlock(),e.createElementBlock("div",E,[o.sizes?(e.openBlock(),e.createElementBlock("div",I,[t[0]||(t[0]=e.createElementVNode("strong",null,"Sizes:",-1)),e.createTextVNode(" "+e.toDisplayString(o.sizes.join(", ")),1)])):e.createCommentVNode("",!0),o.colors?(e.openBlock(),e.createElementBlock("div",N,[t[1]||(t[1]=e.createElementVNode("strong",null,"Colors:",-1)),e.createTextVNode(" "+e.toDisplayString(o.colors.join(", ")),1)])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),o.price?(e.openBlock(),e.createElementBlock("div",V," $"+e.toDisplayString(o.price),1)):e.createCommentVNode("",!0),e.createElementVNode("div",M,[e.createElementVNode("a",{href:o.url||"#",class:"product-button",style:e.normalizeStyle({backgroundColor:n.primaryColor}),onClick:i=>a.handleProductClick(o),target:"_blank",rel:"noopener noreferrer"}," View Product ",12,z)])])],8,f))),128))])])):e.createCommentVNode("",!0)]),e.createElementVNode("div",T,e.toDisplayString(a.formatTime(n.message.timestamp)),1)],2)}const x=l(m,[["render",D]]),O={async sendMessage(s,t){try{return await new Promise(c=>setTimeout(c,1e3+Math.random()*2e3)),this.generateMockResponse(s)}catch(n){throw console.error("API Error:",n),new Error("Failed to send message")}},generateMockResponse(s){const t=s.toLowerCase();return t.includes("shoe")||t.includes("sneaker")||t.includes("footwear")?{message:"I found some amazing shoes for you! Here are my top recommendations:",products:[{id:1,name:"Nike Air Max 270",description:"Comfortable running shoes with excellent cushioning and modern design",price:150,image:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=200&fit=crop&crop=center",url:"/products/nike-air-max-270",category:"Running Shoes",brand:"Nike",sizes:["8","9","10","11","12"],colors:["Black","White","Blue"]},{id:2,name:"Adidas Ultraboost 22",description:"Premium running shoes with responsive boost technology for maximum comfort",price:180,image:"https://images.unsplash.com/photo-1606107557195-0e29a4b5b4aa?w=300&h=200&fit=crop&crop=center",url:"/products/adidas-ultraboost-22",category:"Running Shoes",brand:"Adidas",sizes:["7","8","9","10","11"],colors:["White","Black","Red"]},{id:3,name:"Converse Chuck Taylor All Star",description:"Classic canvas sneakers perfect for casual wear and everyday style",price:65,image:"https://images.unsplash.com/photo-1549298916-b41d501d3772?w=300&h=200&fit=crop&crop=center",url:"/products/converse-chuck-taylor",category:"Casual Shoes",brand:"Converse",sizes:["6","7","8","9","10","11","12"],colors:["Black","White","Red","Blue"]},{id:4,name:"Jordan 1 Retro High",description:"Iconic basketball-inspired sneakers with premium leather construction",price:170,image:"https://images.unsplash.com/photo-1551107696-a4b0c5a0d9a2?w=300&h=200&fit=crop&crop=center",url:"/products/jordan-1-retro-high",category:"Basketball Shoes",brand:"Jordan",sizes:["8","9","10","11","12","13"],colors:["Black/Red","White/Black","Royal Blue"]},{id:5,name:"Vans Old Skool",description:"Timeless skateboarding shoes with signature side stripe design",price:60,image:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=300&h=200&fit=crop&crop=center",url:"/products/vans-old-skool",category:"Skate Shoes",brand:"Vans",sizes:["6","7","8","9","10","11","12"],colors:["Black/White","Navy","Red","Green"]}]}:t.includes("shirt")||t.includes("t-shirt")?{message:"Here are some stylish shirts I recommend:",products:[{id:4,name:"Classic Cotton T-Shirt",description:"100% cotton, comfortable fit",price:25,image:"https://via.placeholder.com/200x150/6f42c1/ffffff?text=Cotton+T-Shirt"},{id:5,name:"Polo Shirt",description:"Premium polo with classic collar",price:45,image:"https://via.placeholder.com/200x150/fd7e14/ffffff?text=Polo+Shirt"}]}:t.includes("help")||t.includes("assistance")?{message:`I'm here to help! I can assist you with:

• **Product recommendations** - Just tell me what you're looking for
• **Size guidance** - Ask about sizing for any product
• **Style advice** - Get suggestions for outfits or combinations
• **General questions** - About our store, policies, or products

What would you like to know?`,products:[]}:t.includes("price")||t.includes("cost")?{message:"I'd be happy to help you find products within your budget! What price range are you looking for, and what type of product interests you?",products:[]}:t.includes("size")||t.includes("fit")?{message:`For sizing help, I can guide you based on the product type. Could you tell me:

• What product you're interested in?
• Your usual size in other brands?
• Any specific fit preferences (loose, fitted, etc.)?`,products:[]}:{message:"Thanks for your message! I'm an AI assistant that can help you find products, answer questions about sizing, and provide style recommendations. What can I help you with today?",products:[]}}},P={name:"ChatWidget",components:{ChatMessage:x},props:{apiUrl:{type:String,default:"https://api.example.com/chat"},title:{type:String,default:"Online Assistant"},primaryColor:{type:String,default:"#007bff"}},data(){return{isOpen:!1,currentMessage:"",messages:[],isLoading:!1,messageId:0,sessionId:this.getSessionId()}},mounted(){this.loadChatState(),this.saveChatState(),this.messages.length===0&&this.addMessage({id:this.getMessageId(),type:"ai",content:"Hello! I'm your AI assistant. How can I help you today?",timestamp:new Date})},methods:{toggleChat(){this.isOpen=!this.isOpen,this.isOpen&&this.$nextTick(()=>{this.focusInput(),this.scrollToBottom()})},closeChat(){this.isOpen=!1},focusInput(){this.$refs.messageInput&&this.$refs.messageInput.focus()},scrollToBottom(){this.$nextTick(()=>{this.$refs.chatBody&&(this.$refs.chatBody.scrollTop=this.$refs.chatBody.scrollHeight)})},async sendMessage(){if(!this.currentMessage.trim()||this.isLoading)return;const s={id:this.getMessageId(),type:"user",content:this.currentMessage.trim(),timestamp:new Date};this.addMessage(s),this.currentMessage="",this.isLoading=!0;try{const t=await O.sendMessage(this.currentMessage,this.apiUrl);this.addMessage({id:this.getMessageId(),type:"ai",content:t.message,products:t.products||[],timestamp:new Date})}catch(t){console.error("Error sending message:",t),this.addMessage({id:this.getMessageId(),type:"ai",content:"Sorry, I encountered an error. Please try again.",timestamp:new Date})}finally{this.isLoading=!1,this.scrollToBottom()}},addMessage(s){this.messages.push(s),this.scrollToBottom(),this.saveChatState()},getMessageId(){return++this.messageId},handleProductClick(s){console.log("Product clicked:",s),this.addMessage({id:this.getMessageId(),type:"user",content:`I'm interested in ${s.name}`,timestamp:new Date}),this.saveChatState()},getSessionId(){let s=localStorage.getItem("assistant-widget-session");return s||(s="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("assistant-widget-session",s)),s},saveChatState(){const s={messages:this.messages,messageId:this.messageId,sessionId:this.sessionId,timestamp:new Date().toISOString()};localStorage.setItem("assistant-widget-state",JSON.stringify(s))},loadChatState(){try{const s=localStorage.getItem("assistant-widget-state");if(s){const t=JSON.parse(s),n=new Date(t.timestamp);(new Date-n)/(1e3*60*60)<24&&t.sessionId===this.sessionId&&(this.messages=t.messages||[],this.messageId=t.messageId||0,this.messages.forEach(a=>{a.timestamp&&(a.timestamp=new Date(a.timestamp))}))}}catch(s){console.warn("Failed to load chat state:",s),this.messages=[],this.messageId=0}}}},A={key:0,class:"button-icon"},L={key:1,class:"button-icon"},W={key:0,class:"chat-window"},R={class:"chat-title"},H={class:"chat-body",ref:"chatBody"},q={class:"messages-container"},U={key:0,class:"loading-message"},j={class:"chat-footer"},F={class:"input-container"},J=["disabled"],G=["disabled"];function K(s,t,n,c,r,a){const o=e.resolveComponent("ChatMessage");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["assistant-widget",{"widget-open":r.isOpen}])},[e.createElementVNode("button",{class:e.normalizeClass(["floating-button",{"button-open":r.isOpen}]),onClick:t[0]||(t[0]=(...i)=>a.toggleChat&&a.toggleChat(...i)),style:e.normalizeStyle({backgroundColor:n.primaryColor})},[r.isOpen?(e.openBlock(),e.createElementBlock("span",L,"✕")):(e.openBlock(),e.createElementBlock("span",A,"💬"))],6),r.isOpen?(e.openBlock(),e.createElementBlock("div",W,[e.createElementVNode("div",{class:"chat-header",style:e.normalizeStyle({backgroundColor:n.primaryColor})},[e.createElementVNode("h3",R,e.toDisplayString(n.title),1),e.createElementVNode("button",{class:"close-button",onClick:t[1]||(t[1]=(...i)=>a.closeChat&&a.closeChat(...i))},"✕")],4),e.createElementVNode("div",H,[e.createElementVNode("div",q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.messages,i=>(e.openBlock(),e.createBlock(o,{key:i.id,message:i,"primary-color":n.primaryColor,onProductClick:a.handleProductClick},null,8,["message","primary-color","onProductClick"]))),128)),r.isLoading?(e.openBlock(),e.createElementBlock("div",U,[...t[6]||(t[6]=[e.createElementVNode("div",{class:"typing-indicator"},[e.createElementVNode("span"),e.createElementVNode("span"),e.createElementVNode("span")],-1)])])):e.createCommentVNode("",!0)])],512),e.createElementVNode("div",j,[e.createElementVNode("div",F,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>r.currentMessage=i),onKeyup:[t[3]||(t[3]=e.withKeys((...i)=>a.sendMessage&&a.sendMessage(...i),["enter"])),t[4]||(t[4]=e.withKeys((...i)=>a.closeChat&&a.closeChat(...i),["esc"]))],placeholder:"Type your message...",class:"message-input",disabled:r.isLoading,ref:"messageInput"},null,40,J),[[e.vModelText,r.currentMessage]]),e.createElementVNode("button",{onClick:t[5]||(t[5]=(...i)=>a.sendMessage&&a.sendMessage(...i)),disabled:!r.currentMessage.trim()||r.isLoading,class:"send-button",style:e.normalizeStyle({backgroundColor:n.primaryColor})},[...t[7]||(t[7]=[e.createElementVNode("span",{class:"send-icon"},"➤",-1)])],12,G)])])])):e.createCommentVNode("",!0)],2)}const Y=l(P,[["render",K]]),Q="",d=(s,t={})=>{const n=e.createApp(Y,{...t}),c=document.querySelector(s);return c?n.mount(c):console.error("Widget container not found:",s),n};window.AssistantWidget={createWidget:d},document.addEventListener("DOMContentLoaded",()=>{const s=document.querySelector("#assistant-widget");s&&!s.hasAttribute("data-initialized")&&(s.setAttribute("data-initialized","true"),d("#assistant-widget",{apiUrl:"https://api.example.com/chat",title:"Online Assistant",primaryColor:"#007bff"}))})});
